# Oauth2 란?

* **Oauth = Open + Authorization**

Oauth란 공개된 승인이라는 뜻인데, Oauth2는 Oauth의 2.0 버전을 의미하며, Oauth1.0 버전을 대폭 개선했기 때문에 버전 1.0은 사용하지 않는 추세이다. 따라서 현재 Oauth2가 인증에 있어 업계 표준 프로토콜로 사용되고 있다.

* **Oauth2는 권한에 대한 프레임워크이다.**

Oauth2는 인증을 하고, 권한을 부여하고, 그 권한으로 보호된 리소스에 접근하는 흐름을 정의한 프레임워크이다.<br/>
권한은 또한 위임될 수 있는데, 예를 들어 사용자로부터 Facebook의 사진 접근에 대한 권한을 할당받은 제 3의 다른 애플리케이션에서 사용자를 대신해 사진 정보를 받아올 수 있다.

* **oauth2 사용에 대한 예제**

<img src="images/oauth2/oauth2 concept.JPG">

제일 왼쪽에 사용자가 있고, 가운데에 구글과 관계없는 타사의 모바일 앱이 있다.
사용자가 모바일 앱으로 본인의 구글 드라이브에 저장된 사진을 보려고 할 때,

1. 모바일 앱이 구글로부터 권한을 얻기 위해 구글의 로그인 화면을 띄운다.
2. 사용자는 로그인 창에서 아이디와 비밀번호를 입력한다. (구글에 직접 로그인하기 때문에 모바일 앱에선 아이디와 비밀번호를 알지 못한다.)
3. 사용자는 모바일 앱에서 본인의 구글 드라이브에 저장된 사진 리소스에 접근할 수 있도록 권한을 허용한다.
4. 구글에서 사진 리소스에 접근할 수 있는 토큰을 모바일 앱으로 발급한다.
5. 이제 모바일 앱은 구글에 저장된 사용자의 사진을 받아와서 활용할 수 있다.

<br/>

간단하게 흐름을 봤는데, 요점은 특정 리소스에 접근할 수 있는 권한을 안전하게 다른 애플리케이션으로 이양하고 사용할 수 있다는 것이다. 로그인은 구글에서 직접 하고 토큰을 발급해서 사용하기 때문에 계정 정보가 제 3자 애플리케이션에 남지 않게된다. 물론 토큰을 탈취당하면 위험해질 수 있지만, 토큰도 제한된 시간만 사용할 수 있다.

<br/><br/>

## Oauth2의 구성요소

<img src="images/oauth2/oauth2 role.JPG">

* **Resource Onwer (리소스 소유자)**

리소스를 소유하고 접근 권한을 부여할 수 있는 사용자이다.

* **Client (클라이언트)**

클라이언트는 사용자를 대신해서 리소스에 접근하는 애플리케이션이다. 따라서, 리소스 소유자는 클라이언트 응용 프로그램을 사용해서 리소스에 대한 정보에 액세스하는 사용자이다.

* **Resource Server (리소스 서버)**

리소스 서버는 사용자의 리소스 정보를 호스팅하는 서버이다. 리소스 서버는 보통 API를 통해 리소스에 대한 접근을 제공한다. 리소스 서버 자체가 직접 리소스를 저장하고 관리하는 서버일 수도 있지만, 다른 서버가 보유하고있는 리소스에 접근할 수 있도록 경유하는 서버로서 사용될 수 있다.

* **Authorization Server (인증 서버)**

인증 서버는 클라이언트에 리소스에 접근할 수 있는 Access Token을 발급하는 서버이다. 인증 서버는 직접 구축할 수도 있고, 인증 서버를 제공하는 서비스를 이용할 수도 있다.

<br/><br/><br/>

## 클라이언트 유형

<img src="images/oauth2/client type.png" width="80%">

클라이언트는 사용자의 권한을 사용해 사용자를 대신해서 리소스에 접근하는 애플리케리션이다. 이 애플리케이션은 네이티브 모바일 앱이거나, jsp로 만들어진 동적 웹 사이트일 수도 있고, 터미널 기반 응용 프로그램일수도 있다.<br/>
인증서버는 각 클라이언트별로 Client ID와 Secret key를 부여할 수 있다. 그래서 각 클라이언트는 인증 서버에서 인증을 수행할 수 있는 클라이언트인지를 검증해야 하는 책임이 있다.<br/>
무수히 많은 클라이언트들이 있겠지만, 클라이언트는 2가지 유형으로 구분되며, 각 유형에 따라 다른 인증 흐름을 사용한다.

<br/>

* Confidential Client (기밀 클라이언트)

Confidential Client는 클라이언트 ID 와 비밀키를 안전하게 유지할 수 있는 애플리케이션이다. 예를 들어, 외부에서 접근할 수 없는 서버에 유일하게 존재하는 애플리케이션이다. 이런 클라이언트들은 클라이언트의 ID와 비밀키만으로 인증서버에서 토큰을 발급받을 수 있다.

* Public Client (공용 클라이언트)

Public Client는 클라이언트의 안정성과 기밀성을 보장할 수 없는 애플리케이션이다. 예를 들어, 여러 사용자가 공용으로 사용하는 웹 사이트나 사용자의 휴대폰이나 테스크톱 등에 설치된 애플리케이션의 경우이다. 즉, 클라이언트 응용 프로그램이 디 컴파일되거나 해당 코드를 여러사람이 볼 수 있는 클라이언트들이다. 이런 경우는 클라이언트 ID 와 비밀키 외에도 부가적인 인증 정보가 더 필요하다.