# API 게이트웨이

API 게이트웨이는 여러개의 리소스 서버가 존재할 때 사용할 수 있는 설계 방식이다.

<br/>

* **기존의 독립된 형태의 리소스 서버 형태**

<img src="images/API Gateway/many resource servers.JPG">
각각의 리소스 서버들이 독립된 서버로 존재한다. 그래서 클라이언트는 필요한 리소스가 있는 리소스 서버에 직접 요청한다.

<br/><br/>

* **API 게이트웨이를 활용한 형태**

<img src="images/API Gateway/API Gateway structure.JPG">
클라이언트는 API Gateway와 통신하게 되고, API Gateway에서 각 필요한 리소스 서버로 대신 요청을 하는 방식이다. 클라이언트는 API Gateway서버 하나와만 통신하기 때문에, 각 리소스 서버의 주소를 알 필요가 없다.<br/>
또한 API Gateway 여러개의 동일한 요청을 각 서버에 골고루 분산시키는 로드 밸런싱 역할을 할 수도 있다. 많은 API Gateway가 있는데, 그 중에서 Spring 진영에는 `Spring Cloud API Gateway`가 있다.


<br/><br/>

* **리소스 요청 흐름 예시**

<img src="images/API Gateway/flow.JPG">

1. 사용자가 클라이언트를 통해 리소스를 요청한다.
2. 클라이언트는 리소스를 API 게이트웨이 서버에 요청한다.
3. API 게이트웨이는 실제 리소스 서버로 요청한다.
4. 리소스 서버가 인증 서버에 토큰 유효성을 요청한다.
5. 권한이 없다면 API Gateway 거쳐서 401 에러 response를 반환한다.
6. 유저가 인증 서버를 통해 인증한다.
7. 인증 서버는 토큰을 클라이언트에게 발급한다.
8. 클라이언트는 토큰과 함께 다시 리소스를 API Gateway로 요청한다.
9. API Gateway가 실제 리소스 서버로 요청한다.
10. 리소스 서버가 다시 토큰 유효성을 인증 서버에 요청한다.
11. 토큰이 유효하면 토큰에 저장된 역할 또는 권한을 확인한다.
12. 역할 또는 권한이 적합하면 API Gateway를 거쳐서 클라이언트로 리소스를 반환한다.
13. 사용자가 클라이언트를 통해 반환된 리소스를 확인한다.